#!/usr/bin/env python3
import argparse
import os
import sys

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
APP_DIR = os.path.join(SCRIPT_DIR, "..", "app")
sys.path.insert(0, APP_DIR)

from html_edit import HtmlEditError, run_html_edit


def main() -> int:
    parser = argparse.ArgumentParser(description="HTML-only Codex editor")
    parser.add_argument("--file", required=True, help="Target HTML file")
    parser.add_argument("--command", required=True, help="Natural language edit command")
    args = parser.parse_args()

    allowlisted = os.environ.get("HTML_EDIT_TARGET_PATH", args.file)
    try:
        result = run_html_edit(args.command, args.file, allowlisted)
    except HtmlEditError as exc:
        print(f"error: {exc}", file=sys.stderr)
        if exc.raw_output is not None:
            print(exc.raw_output, file=sys.stderr)
        return 1

    print(f"success: bytes_written={result['bytes_written']}")
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
